import assert_eq from testing;

fn main() {
    type obj = {
        foo: int,
    };
    let a = new { foo: 42 } as { ? };
    println(a);

    let b: int = a.get("foo").unwrap();
    println(b);

    b += 1;
    assert_eq(a.get("foo").unwrap() as int, 42);

    assert_eq(b, 43);

    // New Syntax

    let c = new { bar: "baz" } as { ? };
    let v0: ?str = c->bar;
    println(v0);

    assert_eq(v0, ?"baz");
    assert_eq(c->quux, none);

    let reached_err = false;

    try {
        let v1: str = c~>barar;
        println(v1);
    } catch err {
        assert_eq(err.message, "Called 'unwrap' on a 'null' option value");
        reached_err = true;
    }

    assert_eq(reached_err, true);
}
